{% extends "league/league_base.html" %} {% block title %}{{ league.name }} Scheduler{% endblock %} {% assets
"scheduler_js" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %} {% block body %}

<form id="hidden-form" style="display: none">{{ simple_form.hidden_tag() }}</form>

<div
    class="info"
    style="display: none"
    captain_checked="{{url_for('static', filename='scheduler-icons/captain_checked.svg')}}"
    captain_unchecked="{{url_for('static', filename='scheduler-icons/captain_unchecked.svg')}}"
    captain_warning="{{url_for('static', filename='scheduler-icons/captain_warning.svg')}}"
    face_neutral_warning="{{url_for('static', filename='scheduler-icons/face-neutral-warning.svg')}}"
    face_neutral="{{url_for('static', filename='scheduler-icons/face-neutral.svg')}}"
    tennis_racket_warning="{{url_for('static', filename='scheduler-icons/tennis-racket-warning.svg')}}"
    tennis_racket="{{url_for('static', filename='scheduler-icons/tennis-racket.svg')}}"
    league_rules_min_games_total="{{ league.rules.min_games_total }}"
    league_rules_max_games_total="{{ league.rules.max_games_total }}"
    league_rules_players_per_match="{{ league.rules.players_per_match }}"
    league_rules_max_games_week="{{ league.rules.max_games_week }}"
    league_rules_min_games_day="{{ league.rules.min_games_day }}"
    league_rules_max_games_day="{{ league.rules.max_games_day }}"
    league_rules_max_week_gap="{{ league.rules.max_week_gap }}"
    league_rules_max_double_headers="{{ league.rules.max_double_headers }}"
    league_rules_min_captained="{{ league.rules.min_captained }}"
    league_rules_max_captained="{{ league.rules.max_captained }}"
    league_rules_minimum_subs_per_game="{{ league.rules.minimum_subs_per_game }}"
    league_rules_assume_busy="{{league.rules.assume_busy}}"
>
    {% if league.flights %} {% for flight in league.flights %}
    <span data-flight-id="{{ flight.id }}"></span>
    {% endfor %} {% endif %}
</div>

<div class="my-3 my-md-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <div class="page-header">
                <h1 class="page-title">{{ league.name }} Scheduler</h1>
            </div>
            <div>
                <button style="margin-right: 10px" onclick="assignCaptainsCallback(this)" type="button" id="assign-captain-button" class="btn btn-lg" title="Assign Captains" aria-label="Assign Captains">
                    <i class="fe fe-user" style="font-size: 1.5em"></i> Assign Captains
                </button>
                <button
                    style="margin-right: 10px"
                    type="button"
                    id="generate-button"
                    class="btn btn-lg"
                    title="Schedule"
                    aria-label="Schedule"
                >
                    <i class="fe fe-star" style="font-size: 1.5em"></i> Schedule
                </button>
                <button type="button" id="save-button" class="btn btn-lg" title="Save" aria-label="Save">
                    <i class="fe fe-save" style="font-size: 1.5em"></i> Save
                </button>
            </div>
        </div>

        <!-- Tab navigation -->
        <ul class="nav nav-tabs" id="flight-tabs">
            {% set first_flight = league.flights | first %} {% if league.flights %} {% for flight in league.flights %}
            <li class="nav-item">
                <a
                    href="javascript:void(0);"
                    class="nav-link flight-tab {% if flight == first_flight %}active{% endif %}"
                    id="flight-tab-{{ flight.id }}"
                    flight-id="{{ flight.id }}"
                    onclick="selectTab('{{ flight.id }}')"
                >
                    {{ flight.name }}
                </a>
            </li>
            {% set is_first_tab = false %} {% endfor %} {% endif %}
        </ul>

        <!-- Tab content -->
        {% if league.flights %} {% for flight in league.flights %}
        <div class="tab-content" id="flight-tab-content" flight-id="{{flight.id}}">
            <div class="row row-cards reveal-after" style="display: none">
                <div class="col-12">{% include 'league/schedule-scheduletool.html' %}</div>
            </div>
            <div class="row row-cards reveal-after" style="display: none">
            <!-- <div class="row row-cards"> -->
                <div class="col-10">{% include 'league/schedule-players.html' %}</div>
                <div class="col-2">{% include 'league/schedule-report.html' %}</div>
            </div>
        </div>
        {% endfor %} {% endif %}
    </div>
</div>

<script>
    var info;
    const AVAILABLE = 1;
    const AVAILABLE_LP = 2;
    const UNAVAILABLE = 3;

    document.addEventListener("DOMContentLoaded", function () {
        info = new InfoClass();
        setupPlayerDraggableOrigins();
        setupPlayerDraggableInGames();
        setupShowActiveFlight();
        addImagesToTableData();
        revealHidden();
        toggleSubs();
        setupDragula();
        let urlHash = window.location.hash;
        if (urlHash.startsWith("#target_flight=")) {
            let flightId = urlHash.split("=")[1];
            selectTab(flightId);
        }

        for (let id of info.flightIds) {
            updatePlayerCards(id);
            organiseAndDisplaySubs(id);
        }
        saveButton = document.getElementById("save-button");
        saveButton.addEventListener("click", saveButtonCallback);

        generateButton = document.getElementById("generate-button");
        generateButton.addEventListener("click", generateButtonCallback);
    });
</script>
{% endblock %}
